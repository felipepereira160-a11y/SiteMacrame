<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CAROMÊ - Arte em Macramê</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body { font-family: Georgia, serif; background: #F2E5D5; color: #803D16; line-height: 1.6; }

    /* Header */
    .header { position: fixed; top: 0; width: 100%; background: rgba(245,241,235,.96); backdrop-filter: blur(10px); padding: 20px 5% 16px; display: flex; flex-direction: column; align-items: center; z-index: 1000; box-shadow: 0 2px 20px rgba(139,111,71,.10); }
    .logo { display:flex; align-items:center; text-decoration:none; transition: transform .3s; }
    .logo:hover { transform: scale(1.03); }
    .logo img { height: 110px; width: auto; }
    .nav-links { display:flex; gap:10px; margin-top:10px; flex-wrap:wrap; justify-content:center; align-items:center; }
    .nav-links a { color:#803D16; text-decoration:none; font-size:16px; padding:4px 8px; border-radius:10px; transition: background-color .2s; text-transform: lowercase; }
    .nav-links a:hover { background:#F2E5D5; }
    .nav-links .divider { color:#A0845C; opacity:.9; user-select:none; }

    /* Hero */
    .hero { margin-top: 160px; min-height: 60vh; display:flex; align-items:center; justify-content:center; background: linear-gradient(rgba(139,111,71,.35), rgba(139,111,71,.35)), url('https://uompmspsrpswwofrrfwv.supabase.co/storage/v1/object/public/product-images/PainelConchas.jpeg') center/cover; }
    .hero .hero-box { background: rgba(139,111,71,.82); color:#F2E5D5; padding: 40px 50px; border-radius: 18px; text-align:center; box-shadow: 0 18px 40px rgba(0,0,0,.2); }
    .hero .hero-box h1 { font-weight:normal; font-size: 40px; }

    /* Sections */
    .section { padding: 70px 5%; max-width: 1200px; margin: 0 auto; scroll-margin-top: 160px; }
    .section-title { font-size: 36px; text-align:center; margin-bottom: 12px; color:#803D16; position:relative; }
    .section-sub { text-align:center; color:#713519; margin-bottom: 34px; }
    .section-title::after { content:''; position:absolute; bottom:-10px; left:50%; transform:translateX(-50%); width:60px; height:3px; background:#A0845C; border-radius:2px; }

    /* Produtos */
    .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(260px,1fr)); gap: 28px; }
    .card { background:#F7F7F7; border-radius:16px; overflow:hidden; box-shadow: 0 8px 22px rgba(139,111,71,.12); transition: transform .25s, box-shadow .25s; }
    .card:hover { transform: translateY(-6px); box-shadow: 0 16px 34px rgba(139,111,71,.18); }
    .card img { width:100%; height:230px; object-fit:cover; display:block; }
    .card .info { padding:16px 18px; display:flex; justify-content:space-between; align-items:center; gap:10px; }
    .price { font-weight:bold; color:#803D16; }
    .btn { background:#803D16; color:#F2E5D5; text-decoration:none; padding:10px 14px; border-radius:10px; display:inline-block; }

    /* Modal */
    .modal { position:fixed; inset:0; background: rgba(0,0,0,.5); display:none; align-items:center; justify-content:center; z-index:2000; }
    .modal.active { display:flex; }
    .modal .box { background:#F7F7F7; color:#713519; max-width: 900px; width: 95%; border-radius:16px; overflow:hidden; display:grid; grid-template-columns: 1fr 1fr; }
    .modal .img { width:100%; height:100%; object-fit:cover; display:block; }
    .modal .content { padding:22px; }
    .modal .title { color:#803D16; font-size:24px; margin-bottom:6px; }
    .modal .mprice { color:#803D16; font-weight:bold; margin-bottom:10px; }
    .modal .features { margin: 10px 0 16px; padding-left: 18px; }
    /* Respeitar quebras de linha no campo de descrição */
    .modal #mdesc { white-space: pre-line; }
    .close { position:absolute; top:12px; right:16px; background: rgba(0,0,0,.6); border:none; font-size:22px; color:#F7F7F7; cursor:pointer; width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; z-index:2101; }
    @media (max-width: 800px){ 
      .modal .box { grid-template-columns: 1fr; max-height: 90vh; overflow:auto; }
    }

    /* Carousel */
    .carousel { position: relative; background:#000; }
    .carousel .cnav { position:absolute; top:50%; transform: translateY(-50%); background: rgba(0,0,0,.4); color:#F7F7F7; border:none; width:40px; height:40px; border-radius:50%; cursor:pointer; font-size:24px; display:flex; align-items:center; justify-content:center; }
    .carousel .cnav:hover { background: rgba(0,0,0,.6); }
    .carousel .prev { left:10px; }
    .carousel .next { right:10px; }
    .carousel .dots { position:absolute; bottom:10px; left:0; right:0; display:flex; gap:8px; justify-content:center; align-items:center; }
    .carousel .dot { width:8px; height:8px; border-radius:50%; background: rgba(255,255,255,.6); cursor:pointer; border:none; padding:0; }
    .carousel .dot.active { background:#F7F7F7; }

    /* Quem Somos */
    .about-history { background:#F7F3EE; border-radius:16px; }
    .about-intro { max-width:900px; margin: 16px auto 30px; text-align:center; color:#713519; font-size:18px; }
    .about-grid { display:grid; grid-template-columns: repeat(3,1fr); gap:24px; }
    .about-card { background:#F7F7F7; border-radius:14px; padding:28px 22px; text-align:center; box-shadow: 0 8px 22px rgba(139,111,71,.12); }
    .about-card h3 { color:#803D16; margin:12px 0 8px; font-size:20px; }
    .about-card p { color:#713519; font-size:16px; }
    .about-icon { width:64px; height:64px; margin:0 auto 10px; border-radius:50%; display:flex; align-items:center; justify-content:center; background:#EEF2E8; color:#803D16; font-size:28px; }
    @media (max-width: 900px){ .about-grid { grid-template-columns:1fr; } }

    /* FAQ */
    .faq { max-width: 900px; margin: 0 auto; }
    .faq-item { background:#F7F7F7; border-radius:12px; padding:14px 18px; box-shadow:0 6px 18px rgba(139,111,71,.12); margin-bottom:14px; }
    .faq-item summary { cursor:pointer; font-weight:600; color:#803D16; list-style:none; outline:none; }
    .faq-item summary::-webkit-details-marker { display:none; }
    .faq-item summary::after { content:'▾'; float:right; transition: transform .2s; }
    .faq-item[open] summary::after { transform: rotate(180deg); }
    .faq-a { color:#713519; margin-top:8px; }
    .faq-a ul { margin:8px 0 0 18px; }

    /* Footer */
    footer .cta { display:flex; gap:12px; justify-content:center; flex-wrap:wrap; }
    .cta .btn.secondary { background:#A0845C; }
  </style>
</head>
<body>
  <header class="header">
    <a class="logo" href="#">
      <img src="https://uompmspsrpswwofrrfwv.supabase.co/storage/v1/object/public/product-images/Logo2.png" alt="CAROMÊ Logo">
    </a>
    <nav class="nav-links">
      <a href="#produtos">produtos</a>
      <span class="divider">/</span>
      <a href="#faq">perguntas frequentes</a>
      <span class="divider">/</span>
      <a href="#sobre">quem somos</a>
      <span class="divider">/</span>
      <a href="#contato">contato</a>
    </nav>
  </header>

  <section class="hero">
    <div class="hero-box"><h1>Onde o fio se transforma em arte</h1></div>
  </section>

  <section id="produtos" class="section">
    <h2 class="section-title">Produtos</h2>
    <p class="section-sub">Peças artesanais feitas em macramê</p>
    <div id="productsGrid" class="grid"></div>
  </section>

  <section id="sobre" class="section about-history">
    <h2 class="section-title">Nossa História</h2>
    
    <p class="about-intro"></p>
    
    <div class="about-grid">
      <article class="about-card">
        <div class="about-icon">❤</div>
        <h3>Feito com Amor</h3>
        <p>Cada nó é cuidadosamente trabalhado, garantindo qualidade e durabilidade em todas as nossas peças artesanais.</p>
      </article>
      <article class="about-card">
        <div class="about-icon">🍃</div>
        <h3>Sustentável</h3>
        <p>Utilizamos apenas materiais naturais e ecologicamente corretos, respeitando o meio ambiente em todo processo.</p>
      </article>
      <article class="about-card">
        <div class="about-icon">🧶</div>
        <h3>Tradição</h3>
        <p>Preservamos técnicas ancestrais de macramê, mantendo viva a tradição artesanal em cada criação única.</p>
      </article>
    </div>
  </section>

  <section id="faq" class="section">
    <h2 class="section-title">Perguntas Frequentes</h2>
    
    <div class="faq">
      </div>
  </section>

  <footer id="contato" class="section">
    <h2 class="section-title">Contato</h2>
    <div class="section-sub">Fale conosco para encomendas e dúvidas.</div>
    <div class="cta">
      <a class="btn" href="https://wa.me/5541995358400" target="_blank" rel="noopener">WhatsApp</a>
      <a class="btn secondary" href="mailto:contato@caromeartes.com.br">E-mail</a>
      <a class="btn secondary" href="https://www.instagram.com/caromeartes/" target="_blank" rel="noopener">Instagram</a>
    </div>
  </footer>

  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <button class="close" onclick="closeModal()" aria-label="Fechar">×</button>
    <div class="box">
      <div class="carousel" aria-label="Galeria de imagens do produto">
        <button id="cprev" class="cnav prev" aria-label="Imagem anterior">‹</button>
        <img id="mimg" class="img" alt="">
        <button id="cnext" class="cnav next" aria-label="Próxima imagem">›</button>
        <div id="mdots" class="dots" aria-hidden="false"></div>
      </div>
      <div class="content">
        <div id="mtitle" class="title"></div>
        <div id="mprice" class="mprice"></div>
        <div id="mdesc"></div>
        <ul id="mfeatures" class="features"></ul>
        <a id="mwa" class="btn" target="_blank" rel="noopener">Falar no WhatsApp</a>
      </div>
    </div>
  </div>

  <script>
    // Estado simples do carrossel
    let carouselState = { images: [], index: 0 };

    async function loadProducts() {
      try {
        const res = await fetch('products.csv');
        const text = await res.text();
        const lines = text.split(/\r?\n/).filter(Boolean);
        if (!lines.length) return;
        const headers = lines.shift().split(';').map(h => h.trim().toLowerCase());
        const idx = (k) => headers.indexOf(k);
        const grid = document.getElementById('productsGrid');

        for (const line of lines) {
          const cols = line.split(';');
          const p = {
            id: cols[idx('id')],
            title: cols[idx('title')],
            price: cols[idx('price')],
            image: cols[idx('image')],
            description: cols[idx('description')],
            features: (cols[idx('features')] || '').split('|').filter(Boolean),
            whatsapp: cols[idx('whatsapp')]
          };

          // Suporte a múltiplas imagens:
          // 1) Se existir coluna "images", usa ela (separador |)
          // 2) Senão, se "image" tiver múltiplas URLs separadas por |, usa elas
          // 3) Caso contrário, usa apenas a imagem principal
          const imagesColIndex = idx('images');
          const imagesFromCol = imagesColIndex >= 0 ? (cols[imagesColIndex] || '') : '';
          const fromImages = imagesFromCol.split('|').map(s => s.trim()).filter(Boolean);
          const fromImage = (p.image || '').split('|').map(s => s.trim()).filter(Boolean);
          p.images = fromImages.length ? fromImages : (fromImage.length ? fromImage : []);
          if (!p.images.length && p.image) p.images = [p.image];

          const card = document.createElement('div');
          card.className = 'card';
          const firstImg = (p.images && p.images[0]) || p.image;
          card.innerHTML = `
            <img src="${firstImg}"
                 srcset="${firstImg} 400w, ${firstImg} 800w, ${firstImg} 1200w"
                 sizes="(min-width: 1100px) 25vw, (min-width: 700px) 33vw, 90vw"
                 loading="lazy" decoding="async" alt="${p.title}">
            <div class="info">
              <div>
                <div>${p.title}</div>
                <div class="price">${p.price}</div>
              </div>
              <div>
                <a href="#" class="btn" data-id="${p.id}">Detalhes</a>
              </div>
            </div>`;
          grid.appendChild(card);

          card.querySelector('.btn').addEventListener('click', (e) => {
            e.preventDefault();
            openModal(p);
          });
        }
      } catch (e) {
        console.error('Erro ao carregar produtos.csv', e);
      }
    }

    function openModal(p) {
      // Configura carrossel
      setupCarousel(p.images && p.images.length ? p.images : (p.image ? [p.image] : []), p.title);
      document.getElementById('mtitle').textContent = p.title;
      document.getElementById('mprice').textContent = p.price;
      // Permite quebrar linhas usando "\n" no CSV
      document.getElementById('mdesc').textContent = (p.description || '').replace(/\\n/g, '\n');
      const ul = document.getElementById('mfeatures');
      ul.innerHTML = '';
      p.features.forEach(f => { const li = document.createElement('li'); li.textContent = f; ul.appendChild(li); });
      const wa = document.getElementById('mwa');
      wa.href = p.whatsapp || '#';
      document.getElementById('modal').classList.add('active');
      document.getElementById('modal').setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    }

    function closeModal(){
      document.getElementById('modal').classList.remove('active');
      document.getElementById('modal').setAttribute('aria-hidden', 'true');
      document.body.style.overflow = 'auto';
    }

    document.getElementById('modal').addEventListener('click', (e) => { if (e.target.id === 'modal') closeModal(); });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });

    // Funções do carrossel
    function setupCarousel(images, title){
      carouselState.images = images || [];
      carouselState.index = 0;
      showCarouselImage(0, title);
      buildDots();
      updateNavVisibility();
    }

    function showCarouselImage(i, title){
      if (!carouselState.images.length) {
        document.getElementById('mimg').src = '';
        document.getElementById('mimg').alt = '';
        document.getElementById('mdots').innerHTML = '';
        return;
      }
      const max = carouselState.images.length;
      if (i < 0) i = max - 1;
      if (i >= max) i = 0;
      carouselState.index = i;
      const src = carouselState.images[i];
      const img = document.getElementById('mimg');
      img.src = src;
      img.srcset = `${src} 800w, ${src} 1600w`;
      img.sizes = '(max-width: 800px) 100vw, 50vw';
      img.alt = title || '';
      highlightDot();
    }

    function buildDots(){
      const dots = document.getElementById('mdots');
      dots.innerHTML = '';
      const total = carouselState.images.length;
      if (total <= 1) { dots.style.display = 'none'; return; }
      dots.style.display = 'flex';
      for (let i=0;i<total;i++){
        const b = document.createElement('button');
        b.className = 'dot' + (i===carouselState.index ? ' active' : '');
        b.type = 'button';
        b.setAttribute('aria-label', `Ir para imagem ${i+1}`);
        b.addEventListener('click', () => showCarouselImage(i));
        dots.appendChild(b);
      }
    }

    function highlightDot(){
      const dots = document.querySelectorAll('#mdots .dot');
      dots.forEach((d, idx) => {
        if (idx === carouselState.index) d.classList.add('active');
        else d.classList.remove('active');
      });
    }

    function updateNavVisibility(){
      const hasMultiple = carouselState.images.length > 1;
      document.getElementById('cprev').style.display = hasMultiple ? 'flex' : 'none';
      document.getElementById('cnext').style.display = hasMultiple ? 'flex' : 'none';
    }

    // Controles de navegação
    document.getElementById('cprev').addEventListener('click', (e) => {
      e.stopPropagation();
      showCarouselImage(carouselState.index - 1);
    });
    document.getElementById('cnext').addEventListener('click', (e) => {
      e.stopPropagation();
      showCarouselImage(carouselState.index + 1);
    });

    // --- MODIFICAÇÃO 3: NOVO SCRIPT ADICIONADO ---

    // NOVA FUNÇÃO PARA CARREGAR O CONTEÚDO DO JSON
    async function loadSiteData() {
      try {
        const res = await fetch('content/siteData.json');
        const data = await res.json();

        // 1. Popula a seção "Sobre"
        const aboutIntro = document.querySelector('.about-intro');
        if (aboutIntro && data.sobre && data.sobre.intro) {
          aboutIntro.textContent = data.sobre.intro;
        }

        // 2. Popula o FAQ
        const faqContainer = document.querySelector('.faq');
        if (faqContainer && data.faq && data.faq.length) {
          faqContainer.innerHTML = ''; // Limpa o container
          data.faq.forEach((item, index) => {
            const details = document.createElement('details');
            details.className = 'faq-item';
            // Abre o primeiro item por padrão
            if (index === 0) details.open = true; 
            
            // Usamos innerHTML aqui para permitir HTML na resposta (como a lista <ul>)
            // E usamos textContent na pergunta para segurança.
            details.innerHTML = `
              <summary>${escapeHTML(item.pergunta || 'Pergunta')}</summary>
              <div class="faq-a">${(item.resposta || '').replace(/\n/g, '<br>')}</div>
            `;
            faqContainer.appendChild(details);
          });
        }
      } catch (e) {
        console.error('Erro ao carregar siteData.json', e);
      }
    }

    // Função auxiliar para evitar XSS
    function escapeHTML(str) {
      return str.replace(/[&<>'"]/g, 
        tag => ({
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          "'": '&#39;',
          '"': '&quot;'
        }[tag] || tag)
      );
    }

    // CHAMA AS DUAS FUNÇÕES (loadProducts() já estava definida acima)
    loadSiteData();
    loadProducts();
  </script>
</body>
</html>